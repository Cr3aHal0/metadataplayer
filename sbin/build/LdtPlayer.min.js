/* 
 * 	
 *	Copyright 2010 Institut de recherche et d'innovation 
 *	contributor(s) : Samuel Huron 
 *	 
 *	contact@iri.centrepompidou.fr
 *	http://www.iri.centrepompidou.fr 
 *	 
 *	This software is a computer program whose purpose is to show and add annotations on a video .
 *	This software is governed by the CeCILL-C license under French law and
 *	abiding by the rules of distribution of free software. You can  use, 
 *	modify and/ or redistribute the software under the terms of the CeCILL-C
 *	license as circulated by CEA, CNRS and INRIA at the following URL
 *	"http://www.cecill.info". 
 *	
 *	The fact that you are presently reading this means that you have had
 *	knowledge of the CeCILL-C license and that you accept its terms.
*/
if(window.IriSP===undefined&&window.__IriSP===undefined)var IriSP={},__IriSP=IriSP;IriSP.traceNum=0;IriSP.trace=function(a,b){if(IriSP.config.gui.debug===true){IriSP.traceNum+=1;IriSP.jQuery("<div>"+IriSP.traceNum+" - "+a+" : "+b+"</div>").appendTo("#Ldt-output")}};IriSP.config=undefined;
IriSP.configDefault={metadata:{format:"cinelab",src:"",load:"jsonp"},gui:{width:650,height:0,mode:"radio",container:"LdtPlayer",debug:false,css:"../src/css/LdtPlayer.css"},player:{type:"jwplayer",src:"../res/swf/player.swf",params:{allowfullscreen:"true",allowscriptaccess:"always",wmode:"transparent"},flashvars:{streamer:"streamer",file:"file",live:"true",autostart:"false",controlbar:"none",playerready:"__IriSP.playerReady"},attributes:{id:"Ldtplayer1",name:"Ldtplayer1"}},module:null};
IriSP.lib={jQuery:"http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js",jQueryUI:"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js",jQueryToolTip:"http://cdn.jquerytools.org/1.2.4/all/jquery.tools.min.js",swfObject:"http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js",cssjQueryUI:"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/themes/base/jquery-ui.css"};IriSP.LdtShareTool="\n<a onclick=\"__IriSP.MyApiPlayer.share('delicious');\" title='partager avec delicious'><span class='share shareDelicious'>&nbsp;</span></a>\n<a onclick=\"__IriSP.MyApiPlayer.share('facebook');\" title='partager avec facebook'> <span class='share shareFacebook'>&nbsp;</span></a>\n<a onclick=\"__IriSP.MyApiPlayer.share('twitter');\" title='partager avec twitter'>  <span class='share shareTwitter'>&nbsp;</span></a>\n<a onclick=\"__IriSP.MyApiPlayer.share('myspace');\" title='partager avec Myspace'>  <span class='share shareMySpace'>&nbsp;</span></a>";
IriSP.MyLdt=null;IriSP.MyTags=null;IriSP.MyApiPlayer=null;IriSP.player=null;IriSP.Durration=null;IriSP.playerLdtWidth=null;IriSP.playerLdtHeight=null;
IriSP.init=function(a){function b(){var h=document.createElement("script");h.setAttribute("type","text/javascript");h.setAttribute("src",IriSP.lib.jQueryToolTip);h.onload=c;h.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded")c("jquery.tools.min.js loded")};var i=document.createElement("script");i.setAttribute("type","text/javascript");i.setAttribute("src",IriSP.lib.swfObject);i.onload=c;i.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState==
"loaded")c("swfobject.js loded")};var j=document.createElement("script");j.setAttribute("type","text/javascript");j.setAttribute("src",IriSP.lib.jQueryUI);j.onload=c;j.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded")c("jquery-ui.min.js loded")};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(h);(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(j);(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(i)}
function c(){e+=1;e===3&&d()}function d(){IriSP.jQuery=window.jQuery.noConflict(true);IriSP.jQuery(document).ready(function(h){var i=IriSP.jQuery("<link>",{rel:"stylesheet",type:"text/css",href:IriSP.lib.cssjQueryUI,"class":"dynamic_css"}),j=IriSP.jQuery("<link>",{rel:"stylesheet",type:"text/css",href:IriSP.config.gui.css,"class":"dynamic_css"});i.appendTo("head");j.appendTo("head");h.browser.msie&&h(".dynamic_css").clone().appendTo("head");IriSP.createMyHtml();IriSP.jQuery.ajax({dataType:IriSP.config.metadata.load,
url:f,success:function(g){IriSP.trace("ajax","success");if(g==="")alert("ERREUR DE CHARGEMENT JSON");else{new __IriSP.Media(g.medias[0].id,g.medias[0].href,g.medias[0].meta["dc:duration"],g.medias[0]["dc:title"],g.medias[0]["dc:description"]);IriSP.trace("__IriSP.MyApiPlayer",IriSP.config.gui.width+"   "+IriSP.config.gui.height+" "+g.medias[0].href+" "+g.medias[0].meta["dc:duration"]+" "+g.medias[0].meta.item.value);IriSP.MyApiPlayer=new __IriSP.APIplayer(IriSP.config.gui.width,IriSP.config.gui.height,
g.medias[0].href,g.medias[0].meta["dc:duration"],g.medias[0].meta.item.value);IriSP.trace("__IriSP.init.main","__IriSP.Ligne");IriSP.MyLdt=new __IriSP.Ligne(g["annotation-types"][0].id,g["annotation-types"][0]["dc:title"],g["annotation-types"][0]["dc:description"],g.medias[0].meta["dc:duration"]);IriSP.trace("__IriSP.init.main","__IriSP.Tags");IriSP.MyTags=new __IriSP.Tags(g.tags);IriSP.jQuery.each(g.annotations,function(l,k){k.meta["id-ref"]==IriSP.MyLdt.id&&IriSP.MyLdt.addAnnotation(k.id,k.begin,
k.end,k.media,k.content.title,k.content.description,k.content.color,k.tags)});IriSP.jQuery.each(g.lists,function(){IriSP.trace("lists","")});IriSP.jQuery.each(g.views,function(){IriSP.trace("views","")})}},error:function(g){alert("ERROR : "+g)}})})}if(a===null)IriSP.config=IriSP.configDefault;else{IriSP.config=a;if(IriSP.config.player.params==null)IriSP.config.player.params=IriSP.configDefault.player.params;if(IriSP.config.player.flashvars==null)IriSP.config.player.flashvars=IriSP.configDefault.player.flashvars;
if(IriSP.config.player.attributes==null)IriSP.config.player.attributes=IriSP.configDefault.player.attributes}var f=IriSP.config.metadata.src;IriSP.jQuery=null;if(window.jQuery===undefined||window.jQuery.fn.jquery!=="1.4.2"){a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",IriSP.lib.jQuery);a.onload=b;a.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded")b()};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(a)}else{IriSP.jQuery=
window.jQuery;b()}var e=0};
IriSP.createMyHtml=function(){var a=IriSP.config.gui.width,b=IriSP.config.gui.height-20;IriSP.trace("__IriSP.createMyHtml",IriSP.config.gui.container);if(IriSP.config.gui.mode=="radio"){IriSP.jQuery("#"+IriSP.config.gui.container).before("<div id='LdtSearchContainer'  style='margin-left:445px;position:absolute;'>\n<div id='LdtSearch' style='display:none;background-color:#EEE;width:165px;boder:1px;border-color:#CFCFCF;position:absolute;text-align:center;'><input id='LdtSearchInput' style='margin-top:2px;margin-bottom:2px;' /></div>\t\n</div>\n <div class='cleaner'></div>");IriSP.trace("__IriSP.createHtml",
IriSP.config.gui.container);IriSP.jQuery("<div id='Ldt-Root'>\n\t<div id='Ldt-PlaceHolder'>\n\t\t<a href='http://www.adobe.com/go/getflashplayer'>Get flash</a> to see this player\t\n\t</div>\n\t<div id='Ldt-controler' class='demo'>\n\t\t<div class='Ldt-Control1' >\n\t\t\t<button id='ldt-CtrlPlay' onclick='__IriSP.MyApiPlayer.play()'>Lecture / Pause </button>\n\t\t\t<button id='ldt-CtrlNext' onclick='__IriSP.MyLdt.nextAnnotation()'>Suivant</button>\n\t\t</div>\n\t\t<div id='Ldt-Annotations' class='ui-slider'>\n\t\t\t<div id='slider-range-min'></div>\n\t</div>\n\t\t<div class='Ldt-Control2'>\n\t\t\t<button id='ldt-CtrlLink'  onclick='__IriSP.searchblock()'> Rechercher </button>\n\t\t\t<button id='ldt-CtrlSound' onclick='__IriSP.MyApiPlayer.mute()'>Sound</button>\n\t\t</div>\n  <div class='cleaner'>&nbsp;</div> \n  <div id='Ldt-Show-Arrow-container'>\n  \t<div id='Ldt-Show-Arrow'> </div>\n  </div>\n</div>\n<div>\n <div id='ldt-Show'> </div>\n\t<div id='Ldt-ShowAnnotation-audio' class='demo' >\n\t\t<div id='Ldt-SaTitle'></div>\n\t\t<div id='Ldt-SaDescription'></div>\n \t\t<div class='cleaner'><!--&nbsp;--\></div>\n </div>\n <div id='Ldt-SaKeyword'>\n <div id='Ldt-SaKeywordText'>  </div>\n <div class='cleaner'></div>\n <div id='Ldt-SaShareTools'>\n \n "+
IriSP.LdtShareTool+"\n \n  </div>\n <div class='cleaner'></div></div>  </div><div id='Ldt-output' style='clear:left;float:none;position:relative;height:200px;width:"+a+"px;overflow:scroll;' ></div>").appendTo("#"+IriSP.config.gui.container);if(IriSP.jQuery.browser.msie==true&&IriSP.jQuery.browser.version=="7.0"){IriSP.jQuery("#Ldt-Root").css("padding-top","25px");IriSP.trace("__IriSP.createHtml","IE7 SPECIAL ")}}else IriSP.config.gui.mode=="video"&&IriSP.jQuery("<div id='LdtSearchContainer'  style='margin-top:"+
b+"px;margin-left:445px;position:absolute;'>\n<div id='LdtSearch' style='background-color:#EEE;display:none;width:165px;boder:1px;border-color:#CFCFCF;position:absolute;text-align:center;z-index:999;'><input id='LdtSearchInput' style='margin-top:2px;margin-bottom:2px;' /></div>\t\n</div>\n<div id='Ldt-Root'>\n\t<div id='Ldt-PlaceHolder'>\n\t\t<a href='http://www.adobe.com/go/getflashplayer'>Get flash</a> to see this player\t\n\t</div>\n\t<div id='Ldt-controler' class='demo'>\n\t\t<div class='Ldt-Control1' >\n\t\t\t<button id='ldt-CtrlPlay' onclick='__IriSP.MyApiPlayer.play()'>Lecture / Pause </button>\n\t\t\t<button id='ldt-CtrlNext' onclick='__IriSP.MyLdt.nextAnnotation()'>Suivant</button>\n\t\t</div>\n\t\t<div id='Ldt-Annotations' class='ui-slider'>\n\t\t\t<div id='slider-range-min'></div>\n\t</div>\n\t\t<div class='Ldt-Control2'>\n\t\t\t<button id='ldt-CtrlLink'  onclick='__IriSP.searchblock()'> Rechercher </button>\n\t\t\t<button id='ldt-CtrlSound' onclick='__IriSP.MyApiPlayer.mute()'>Sound</button>\n\t\t</div>\n  <div class='cleaner'>&nbsp;</div> \n  <div id='Ldt-Show-Arrow-container'>\n  \t<div id='Ldt-Show-Arrow'> </div>\n  </div>\n</div>\n<div>\n <div id='ldt-Show'> </div>\n\t<div id='Ldt-ShowAnnotation-audio' class='demo' >\n\t\t<div id='Ldt-SaTitle'></div>\n\t\t<div id='Ldt-SaDescription'></div>\n \t\t<div class='cleaner'><!--&nbsp;--\></div>\n </div>\n <div id='Ldt-SaKeyword'>\n <div id='Ldt-SaKeywordText'>  </div>\n <div class='cleaner'></div>\n <div id='Ldt-SaShareTools'>\n \n "+
IriSP.LdtShareTool+"\n \n  </div>\n <div class='cleaner'></div></div>  </div><div id='Ldt-output'></div>").appendTo("#"+IriSP.config.gui.container);IriSP.trace("__IriSP.createHtml",IriSP.jQuery.browser.msie+" "+IriSP.jQuery.browser.version);IriSP.trace("__IriSP.createHtml","end");IriSP.jQuery("#Ldt-Annotations").width(a-150);IriSP.jQuery("#Ldt-Show-Arrow-container").width(a-150);IriSP.jQuery("#Ldt-ShowAnnotation-audio").width(a-10);IriSP.jQuery("#Ldt-ShowAnnotation-video").width(a-10);IriSP.jQuery("#Ldt-SaKeyword").width(a-
10);IriSP.jQuery("#Ldt-controler").width(a-10);IriSP.jQuery("#Ldt-Control").attr("z-index","100");IriSP.jQuery("#Ldt-controler").hide();IriSP.jQuery("<div id='Ldt-load-container'><div id='Ldt-loader'>&nbsp;</div> Chargement... </div>").appendTo("#Ldt-ShowAnnotation-audio");IriSP.config.gui.mode=="radio"&&IriSP.jQuery("#Ldt-load-container").attr("width",IriSP.config.gui.width);IriSP.config.gui.debug===true?IriSP.jQuery("#Ldt-output").show():IriSP.jQuery("#Ldt-output").hide()};
__IriSP.Media=function(a,b,c,d,f){this.id=a;this.url=b;this.title=d;this.description=f;this.duration=c;this.lignes=[];IriSP.trace("__IriSP.Media","Media ID : "+a);IriSP.trace("__IriSP.Media","Media URL : "+b);IriSP.trace("__IriSP.Media","Media title : "+d)};__IriSP.Media.prototype.createPlayerMedia=function(a,b,c,d){IriSP.MyApiPlayer=new __IriSP.APIplayer(a,b,this.url,this.duration,c,d)};__IriSP.Media.prototype.getMediaDuration=function(){return this.duration};
__IriSP.Media.prototype.getMediaTitle=function(){return this.title};
IriSP.createInterface=function(a,b,c){IriSP.jQuery("#Ldt-controler").show();IriSP.trace("__IriSP.createInterface",a+","+b+","+c+",");IriSP.jQuery("#Ldt-ShowAnnotation").click(function(){});IriSP.jQuery("#Ldt-PlaceHolder").attr("top");IriSP.jQuery("#Ldt-PlaceHolder").attr("left");IriSP.jQuery("#slider-range-min").slider({value:0,min:1,max:c/1E3,step:0.1,slide:function(d,f){IriSP.MyApiPlayer.seek(f.value)}});IriSP.trace("__IriSP.createInterface","ICI");IriSP.jQuery("#amount").val(IriSP.jQuery("#slider-range-min").slider("value")+
" s");IriSP.jQuery(".Ldt-Control1 button:first").button({icons:{primary:"ui-icon-play"},text:false}).next().button({icons:{primary:"ui-icon-seek-next"},text:false});IriSP.jQuery(".Ldt-Control2 button:first").button({icons:{primary:"ui-icon-search"},text:false}).next().button({icons:{primary:"ui-icon-volume-on"},text:false});IriSP.trace("__IriSP.createInterface","ICI2");IriSP.jQuery("#ldt-CtrlPlay").attr("style","background-color:#CD21C24;");IriSP.jQuery("#Ldt-load-container").hide();IriSP.config.gui.mode==
"radio"&IriSP.jQuery.browser.msie!=true&&IriSP.jQuery("#Ldtplayer1").attr("height","0");IriSP.trace("__IriSP.createInterface","3");IriSP.trace("__IriSP.createInterface","END")};__IriSP.APIplayer=function(a,b,c,d,f,e){this.hashchangeUpdate=this.player=null;this.width=a;this.height=b;this.url=c;this.duration=d;this.streamerPath=f;this.MySwfPath=e;IriSP.MyApiPlayer=this;IriSP.createPlayer(this.url,this.streamerPath);IriSP.trace("__IriSP.APIplayer","__IriSP.createPlayer")};
__IriSP.APIplayer.prototype.ready=function(){IriSP.createInterface(this.width,this.height,this.duration);if(window.addEventListener)window.addEventListener("hashchange",function(){var a=IriSP.retrieveTimeFragment(window.location.href);IriSP.trace("__IriSP.APIplayer.prototype.ready",a);if(IriSP.MyApiPlayer.hashchangeUpdate==null)IriSP.MyApiPlayer.seek(a);else IriSP.MyApiPlayer.hashchangeUpdate=null},false);else window.attachEvent&&window.attachEvent("onhashchange",function(){IriSP.trace("hashchange",
a);var a=IriSP.retrieveTimeFragment(window.location.href);if(IriSP.MyApiPlayer.hashchangeUpdate==null)IriSP.MyApiPlayer.seek(a);else IriSP.MyApiPlayer.hashchangeUpdate=null},false);IriSP.jQuery("#LdtSearchInput").keydown(function(){IriSP.Search(this.value)});IriSP.jQuery("#LdtSearchInput").keyup(function(){IriSP.Search(this.value)})};__IriSP.APIplayer.prototype.pause=function(){this.hashchangeUpdate=true;IriSP.player.sendEvent("PAUSE")};
__IriSP.APIplayer.prototype.play=function(){this.hashchangeUpdate=true;if(IriSP.config.player.type=="jwplayer")IriSP.player.sendEvent("PLAY");else if(IriSP.config.player.type=="dailymotion"||IriSP.config.player.type=="youtube"){var a=IriSP.player.getPlayerState();IriSP.trace("__IriSP.APIplayer.prototype.play.status",a);a!=1?IriSP.player.playVideo():IriSP.player.pauseVideo()}};
__IriSP.APIplayer.prototype.mute=function(){IriSP.player.sendEvent("MUTE");IriSP.jQuery(".ui-icon-volume-on").css("background-position")=="-144px -160px"?IriSP.jQuery(".ui-icon-volume-on").css("background-position","-130px -160px"):IriSP.jQuery(".ui-icon-volume-on").css("background-position","-144px -160px")};
__IriSP.APIplayer.prototype.share=function(a){var b=encodeURIComponent("J'\u00e9coute Les Retours du Dimanche : "),c=window.location.href,d;if(a=="facebook")d="http://www.facebook.com/share.php?u=";else if(a=="twitter")d="http://twitter.com/home?status="+b;else if(a=="myspace")d="http://www.myspace.com/Modules/PostTo/Pages/?u=";else if(a=="delicious")d="http://delicious.com/save?url=";else if(a=="JameSpot")d="http://www.jamespot.com/?action=spotit&u=";window.open(d+encodeURIComponent(c))};
__IriSP.APIplayer.prototype.seek=function(a){if(a==0)a=1;IriSP.trace("__IriSP.APIplayer.prototype.seek",a);if(IriSP.config.player.type=="jwplayer")IriSP.player.sendEvent("SEEK",a);else if(IriSP.config.player.type=="dailymotion"||IriSP.config.player.type=="youtube")IriSP.player.seekTo(a);this.changePageUrlOffset(a)};__IriSP.APIplayer.prototype.update=function(a){if(a!=0){this.hashchangeUpdate=true;IriSP.trace("__IriSP.APIplayer.prototype.update",a);IriSP.player.sendEvent("SEEK",a)}};
__IriSP.APIplayer.prototype.changePageUrlOffset=function(a){IriSP.trace("__IriSP.APIplayer.prototype.changePageUrlOffset","CHANGE URL "+a);window.location.hash="#t="+a;window.location.href=window.location.href};IriSP.jumpToTimeoffset=function(a){IriSP.MyApiPlayer.changePageUrlOffset(a.time.value)};IriSP.retrieveTimeFragment=function(a){var b=0,c=0;if(a.split("#")[1]!=null){b=a.split("#")[1];if(b.substring(2)!=null)c=b.substring(2)}return c};
IriSP.ignoreTimeFragment=function(a){if(a.split("#")[1]!=null)var b=a.split("#")[0];return b};IriSP.currentPosition=0;IriSP.currentVolume=50;IriSP.player=null;IriSP.startPosition=null;IriSP.firstplay=false;
IriSP.createPlayer=function(a,b){if(IriSP.config.player.type=="dailymotion")IriSP.config.player.src+="&chromeless=1&enableApi=1";else if(IriSP.config.player.type=="youtube")IriSP.config.player.src+="&enablejsapi=1&version=3";IriSP.trace("__IriSP.createPlayer","start");IriSP.myUrlFragment=a.split(b);var c=IriSP.jQuery.extend(true,{},IriSP.config);c.player.flashvars.autostart="true";c.player.flashvars.streamer=b;c.player.flashvars.file=IriSP.myUrlFragment[1];var d=c.player.flashvars,f=c.player.params;
c=c.player.attributes;IriSP.trace("__IriSP.createPlayer","SWFOBJECT src:"+IriSP.config.player.src+" "+IriSP.config.gui.width+" "+IriSP.config.gui.height);swfobject.embedSWF(IriSP.config.player.src,"Ldt-PlaceHolder",IriSP.config.gui.width,IriSP.config.gui.height,"9.0.115",false,d,f,c)};IriSP.playerReady=function(a){IriSP.player=window.document[a.id];IriSP.MyApiPlayer.ready(IriSP.player);a=IriSP.retrieveTimeFragment(document.location.href);IriSP.startPosition=a;IriSP.addListeners()};
IriSP.addListeners=function(){if(IriSP.player){IriSP.trace("__IriSP.addListeners","ADD  Listener ");IriSP.player.addModelListener("TIME","__IriSP.positionListener");IriSP.player.addControllerListener("VOLUME","__IriSP.volumeListener");IriSP.player.addModelListener("STATE","__IriSP.stateMonitor")}else IriSP.setTimeout("__IriSP.addListeners()",100)};
IriSP.stateMonitor=function(a){if(a.newstate=="PAUSED"){IriSP.trace("__IriSP.stateMonitor","PAUSE");IriSP.MyApiPlayer.changePageUrlOffset(IriSP.currentPosition);IriSP.jQuery(".ui-icon-play").css("background-position","0px -160px")}else if(a.newstate=="PLAYING"){IriSP.trace("__IriSP.stateMonitor","PLAYING "+IriSP.startPosition);if(IriSP.config.player.flashvars.autostart=="false"&&IriSP.firstplay==false&&IriSP.startPosition==0){IriSP.trace("__IriSP.stateMonitor","first stop ???");IriSP.MyApiPlayer.play();
IriSP.firstplay=true;IriSP.MyLdt.checkTime(1)}if(IriSP.startPosition!=null){IriSP.MyApiPlayer.update(IriSP.startPosition);IriSP.startPosition=null}IriSP.jQuery(".ui-icon-play").css("background-position","-16px -160px")}else a.newstate=="BUFFERING"&&IriSP.trace("__IriSP.stateMonitor","BUFFERING : "+IriSP.config.player.flashvars.autostart)};
IriSP.positionListener=function(a){IriSP.currentPosition=a.position;var b=document.getElementById("posit");if(b)b.innerHTML="position: "+IriSP.currentPosition;IriSP.jQuery("#slider-range-min").slider("value",a.position);IriSP.jQuery("#amount").val(a.position+" s");IriSP.MyLdt.checkTime(IriSP.currentPosition)};IriSP.volumeListener=function(a){IriSP.currentVolume=a.percentage;if(a=document.getElementById("vol"))a.innerHTML="volume: "+IriSP.currentVolume};
onDailymotionPlayerReady=function(a){IriSP.player=document.getElementById(IriSP.config.player.attributes.id);IriSP.MyApiPlayer.ready(IriSP.player);var b=IriSP.retrieveTimeFragment(document.location.href);IriSP.startPosition=b;IriSP.DailymotionAddListeners();IriSP.MyApiPlayer.ready(a)};
IriSP.DailymotionAddListeners=function(){if(IriSP.player){IriSP.trace("__IriSP.addListeners","ADD  Listener ");setTimeout("__IriSP.DailymotionPositionListener()",100);IriSP.DailymotionPositionListener();IriSP.player.addModelListener("VOLUME","__IriSP.volumeListener")}else IriSP.setTimeout("__IriSP.DailymotionAddListeners()",100)};
IriSP.DailymotionPositionListener=function(){IriSP.currentPosition=IriSP.player.getCurrentTime();IriSP.jQuery("#slider-range-min").slider("value",IriSP.currentPosition);IriSP.jQuery("#amount").val(IriSP.currentPosition+" s");setTimeout("__IriSP.DailymotionPositionListener()",10)};
onYouTubePlayerReady=function(){var a=IriSP.retrieveTimeFragment(document.location.href);IriSP.player=document.getElementById(IriSP.config.player.attributes.id);IriSP.startPosition=a;IriSP.MyApiPlayer.ready(IriSP.player);IriSP.MyApiPlayer.seek(a);IriSP.MyApiPlayer.play();IriSP.YouTubeAddListeners();IriSP.trace("onYouTubePlayerReady=",a)};
IriSP.YouTubeAddListeners=function(){if(IriSP.player){IriSP.trace("__IriSP.addListeners","ADD  Listener ");IriSP.player.addEventListener("onStateChange","__IriSP.YouTubeStateMonitor");setTimeout("__IriSP.YouTubePositionListener()",100);IriSP.player.addModelListener("VOLUME","__IriSP.volumeListener")}else IriSP.setTimeout("__IriSP.YouTubePositionListener()",100)};
IriSP.YouTubePositionListener=function(){IriSP.currentPosition=IriSP.player.getCurrentTime();IriSP.MyLdt.checkTime(IriSP.currentPosition);IriSP.jQuery("#slider-range-min").slider("value",IriSP.currentPosition);IriSP.jQuery("#amount").val(IriSP.currentPosition+" s");IriSP.MyLdt.checkTime(IriSP.currentPosition);setTimeout("__IriSP.YouTubePositionListener()",10)};
IriSP.YouTubeStateMonitor=function(){IriSP.player.addModelListener("__IriSP.YouTubeStateMonitor ",newstate);if(newstate=="2"){IriSP.trace("__IriSP.stateMonitor","PAUSE");IriSP.MyApiPlayer.changePageUrlOffset(IriSP.currentPosition)}else if(newstate=="1"){if(IriSP.startPosition!=null){IriSP.MyApiPlayer.update(IriSP.startPosition);IriSP.startPosition=null}}else if(newstate=="-1"){if(IriSP.startPosition!=null){IriSP.MyApiPlayer.update(IriSP.startPosition);IriSP.startPosition=null}}else newstate=="3"&&
IriSP.trace("__IriSP.stateMonitor","BUFFERING : ")};IriSP.stripHtml=function(a){return a.replace(/\\&/g,"&amp;").replace(/\\</g,"&lt;").replace(/\\>/g,"&gt;").replace(/\\t/g,"&nbsp;&nbsp;&nbsp;").replace(/\\n/g,"<br />").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};IriSP.DEC_HEXA_COLOR=function(a){for(var b="",c;a>15;){c=a-Math.floor(a/16)*16;b="0123456789ABCDEF".charAt(c)+b;a=Math.floor(a/16)}b="0123456789ABCDEF".charAt(a)+b;if(b=="FFCC00")b="";return b};IriSP.SearchOldValue="";
IriSP.searchblockOpen=false;
IriSP.searchblock=function(){IriSP.trace("__IriSP.searchblock",IriSP.searchblockOpen);if(IriSP.searchblockOpen==false){IriSP.jQuery(".ui-icon-search").css("background-position","-144px -112px");IriSP.jQuery("#LdtSearch").show(250);IriSP.jQuery("#LdtSearchInput").css("background-color","#fff");IriSP.jQuery("#LdtSearchInput").focus();IriSP.jQuery("#LdtSearchInput").attr("value",IriSP.SearchOldValue);IriSP.Search(IriSP.SearchOldValue);IriSP.searchblockOpen=true}else{IriSP.SearchOldValue=IriSP.jQuery("#LdtSearchInput").attr("value");
IriSP.jQuery("#LdtSearchInput").attr("value","");IriSP.SearchClean();IriSP.jQuery(".ui-icon-search").css("background-position","-160px -112px");IriSP.jQuery("#LdtSearch").hide(250);IriSP.searchblockOpen=false}};
IriSP.Search=function(a){annotations=IriSP.LDTligne.annotations;IriSP.trace("__IriSP.Search",annotations.length+" "+a);var b=0,c=0,d=0;IriSP.trace(a,a.length);var f=a.toLowerCase();IriSP.trace("__IriSP.Search",annotations.length+" "+f);if(f.length>=3){for(var e=0;e<annotations.length;++e){annotation=annotations[e];IriSP.jQuery("#output2").text(annotation.title+" ?= "+a);chaine1=annotation.title.toLowerCase();chaine2=annotation.description.toLowerCase();chaine3=annotation.htmlTags.toLowerCase();if(chaine1.indexOf(f,
0)!=-1)b+=1;if(chaine2.indexOf(f,0)!=-1)b+=1;if(chaine3.indexOf(f,0)!=-1)b+=1;c+=b;if(b>0){d=b*8;IriSP.jQuery("#"+annotation.id).dequeue();IriSP.jQuery("#"+annotation.id).animate({height:d},200);IriSP.jQuery("#"+annotation.id).css("border","2px");IriSP.jQuery("#"+annotation.id).css("border-color","red");IriSP.jQuery("#"+annotation.id).animate({opacity:0.6},200);IriSP.trace("!!!!!!!!!!!!!!!!!!"," ?= "+annotation.id);IriSP.jQuery("#LdtSearchInput").css("background-color","#e1ffe1")}else{IriSP.jQuery("#"+
annotation.id).dequeue();IriSP.jQuery("#"+annotation.id).animate({height:0},250);IriSP.jQuery("#"+annotation.id).animate({opacity:0.3},200)}b=0}c==0&&IriSP.jQuery("#LdtSearchInput").css("background-color","#f6f6f6")}else if(a.length==0){IriSP.SearchClean();IriSP.jQuery("#LdtSearchInput").css("background-color","#fff")}else{IriSP.SearchClean();IriSP.jQuery("#LdtSearchInput").css("background-color","#f6f6f6")}};
IriSP.SearchClean=function(){annotations=IriSP.LDTligne.annotations;for(var a=0;a<annotations.length;++a){annotation=annotations[a];IriSP.jQuery("#"+annotation.id).dequeue();IriSP.jQuery("#"+annotation.id).animate({height:0},100);IriSP.jQuery("#"+annotation.id).css("border","0px");IriSP.jQuery("#"+annotation.id).css("border-color","red");IriSP.jQuery("#"+annotation.id).animate({opacity:0.3},100)}};IriSP.SearchCleanString=function(a){var b=RegExp("(chien)","g");a.replace(b,"");return a};
IriSP.SearchThisSegment=function(a){IriSP.jQuery("#LdtSearchInput").text(a.title);IriSP.trace("__IriSP.Ligne.prototype.checkTimeLigne",a.title)};IriSP.LDTligne=null;__IriSP.Ligne=function(a,b,c,d){this.id=a;this.title=b;this.description=c;this.annotations=[];this.duration=d;this.annotationOldRead="";IriSP.LDTligne=this;IriSP.trace("__IriSP.Ligne","CREATE "+IriSP.LDTligne)};
__IriSP.Ligne.prototype.addAnnotation=function(a,b,c,d,f,e,h,i){this.annotations.push(new __IriSP.Annotation(a,b,c,d,f,e,h,i,this.duration))};__IriSP.Ligne.prototype.onClickLigneAnnotation=function(){};__IriSP.Ligne.prototype.searchLigneAnnotation=function(){};__IriSP.Ligne.prototype.listAnnotations=function(){};
__IriSP.Ligne.prototype.nextAnnotation=function(){var a=this.numAnnotation(this.annotationOldRead)+1,b=this.annotations[a];if(a<this.annotations.length-1){IriSP.player.sendEvent("SEEK",b.begin/1E3);IriSP.trace("LIGNE  ","| next = "+a+" - "+this.annotations.length+" | seek :"+b.begin/1E3)}else IriSP.player.sendEvent("SEEK",this.annotations[0].begin/1E3)};__IriSP.Ligne.prototype.numAnnotation=function(a){for(var b=0;b<this.annotations.length;++b)if(a==this.annotations[b])return b};
__IriSP.Ligne.prototype.checkTime=function(a){for(var b=-1,c=0;c<this.annotations.length;++c){b=this.annotations[c];if(a>b.begin/1E3&&a<b.end/1E3){if(b!=this.annotationOldRead){this.annotationOldRead=b;IriSP.jQuery("#Ldt-SaTitle").text(b.title);IriSP.jQuery("#Ldt-SaDescription").text(b.description);IriSP.jQuery("#Ldt-SaKeywordText").html("Mots clefs : "+b.htmlTags);a=b.timeToPourcent(b.begin*1+(b.end*1-b.begin*1)/2,b.duration*1);IriSP.jQuery("#Ldt-Show-Arrow").animate({left:a+"%"},1E3);IriSP.jQuery("#"+
b.id).animate({alpha:"100%"},1E3);IriSP.ignoreTimeFragment(window.location.href)}break}else b=-1}if(b==-1)if(b!=this.annotationOldRead){IriSP.trace("Check : ","pas d'annotation ici ");IriSP.jQuery("#Ldt-SaTitle").text("");IriSP.jQuery("#Ldt-SaDescription").text("");IriSP.jQuery("#Ldt-SaKeywordText").html("");IriSP.jQuery("#Ldt-ShowAnnotation").slideUp();this.annotationOldRead&&IriSP.jQuery("#"+this.annotationOldRead.id).animate({alpha:"70%"},1E3);this.annotationOldRead=b}};
__IriSP.Annotation=function(){IriSP.trace("annotation ","r\u00e9ussi")};__IriSP.Annotation=function(a,b,c,d,f,e,h,i,j){this.id=a;this.begin=b;this.end=c;this.media=d;this.description=e;this.title=f;this.color=h;this.tags=i;this.htmlTags="";this.duration=j;this.draw();this.drawTags();IriSP.trace("Annotation created : ",a)};
__IriSP.Annotation.prototype.draw=function(){var a=this.timeToPourcent(this.begin,this.duration),b=this.timeToPourcent(this.end,this.duration)-a,c=this.title.substr(0,55);IriSP.jQueryAnnotationTemplate="<div title='"+IriSP.stripHtml(c)+"' id='"+this.id+"'  class='ui-slider-range ui-slider-range-min ui-widget-header iri-chapter' width='100%' style=\"left:"+a+"%; width:"+b+"%; padding-top:15px; border-left:solid 1px #aaaaaa; border-right:solid 1px #aaaaaa; background:#"+IriSP.DEC_HEXA_COLOR(this.color)+
';" onClick="__IriSP.MyApiPlayer.seek(\''+Math.round(this.begin/1E3)+"');__IriSP.jQuery('#Ldt-ShowAnnotation').slideDown();\"    ></div> ";IriSP.jQuerytoolTipTemplate="<div class='Ldt-tooltip'><div class='title'>"+IriSP.stripHtml(this.title)+"</div><div class='time'>"+this.begin+" : "+this.end+"</div><div class='description'>"+IriSP.stripHtml(this.description)+"</div></div>";IriSP.jQuery("<div>"+IriSP.jQueryAnnotationTemplate+"</div>").appendTo("#Ldt-Annotations");IriSP.jQuery("#"+this.id).tooltip({effect:"slide"});
IriSP.jQuery("#"+this.id).fadeTo(0,0.3);IriSP.jQuery("#"+this.id).mouseover(function(){IriSP.jQuery("#"+this.id).animate({opacity:0.6},5)}).mouseout(function(){IriSP.jQuery("#"+this.id).animate({opacity:0.3},5)});IriSP.trace("__IriSP.Annotation.prototype.draw","ADD ANOTATION : "+this.begin+" "+this.end+" "+IriSP.stripHtml(this.title)+" | "+a+" | "+b+" | duration = "+this.duration)};
__IriSP.Annotation.prototype.drawTags=function(){if(this.tags!=undefined)for(var a=0;a<this.tags.length;++a)this.htmlTags+="<span> "+IriSP.MyTags.getTitle(this.tags[a]["id-ref"])+" </span> , "};__IriSP.Annotation.prototype.tootTipAnnotation=function(){return this.color+" "+this.type+" apple"};__IriSP.Annotation.prototype.onRollOverAnnotation=function(){this.tootTip()};__IriSP.Annotation.prototype.timeToPourcent=function(a,b){return parseInt(Math.round(a/b*100))};
__IriSP.Tags=function(a){this.myTags=a;this.htmlTags=null;this.weigthMax=0};__IriSP.Tags.prototype.addAnnotation=function(a){for(var b=0;b<this.myTags.length;++b){this.myTags[b].mySegments=[];if(a.tags!=null)for(var c=0;c<a.tags.length;++c)if(this.myTags[b].id==a.tags[c]["id-ref"]){this.myTags[b].mySegments.push([a.begin,a.end,a.id]);var d=this.myTags[b].mySegments.length;if(this.weigthMax<d)this.weigthMax=d}}};
__IriSP.Tags.prototype.getTitle=function(a){for(var b=0;b<this.myTags.length;++b)if(this.myTags[b].id==a)return this.myTags[b].meta["dc:title"]};
__IriSP.Tags.prototype.draw=function(){IriSP.trace("__IriSP.Tags.prototype.draw"," !!! WELL START ");for(var a=0;a<this.myTags.length;++a){IriSP.trace("__IriSP.Tags.prototype.draw"," ADD Tags : "+this.myTags[a].id);if(this.myTags[a].id!=null)this.htmlTags+="<span onclick=\"MyTags.show( '"+this.myTags[a].id+'\');" style="font-size:'+(this.myTags[a].mySegments.length/this.weigthMax*10+8)+'px;" alt="'+this.myTags[a].mySegments.length+'"> '+this.myTags[a].meta["dc:title"]+" </span> , "}IriSP.jQuery("#Ldt-Tags").html(this.htmlTags);
IriSP.trace("__IriSP.Tags.prototype.draw"," !!!!  END WMAX= "+this.weigthMax)};
__IriSP.Tags.prototype.show=function(a){for(var b=1.0E20,c=1.0E20,d=0,f=0,e=0;e<this.myTags.length;++e)if(this.myTags[e].id==a){IriSP.trace("######### TAG DRAWing : "," END");for(var h=0;h<this.myTags[e].mySegments.length;++h){if(void 0>this.myTags[e].mySegments[h][0]){b=this.myTags[e].mySegments[h][0];c=this.myTags[e].mySegments[h][1]}if(void 0>this.myTags[e].mySegments[h][0]){d=this.myTags[e].mySegments[h][0];f=this.myTags[e].mySegments[h][1]}}}a=IriSP.timeToPourcent(b*1+(c-b)/2,IriSP.MyLdt.duration);
d=IriSP.timeToPourcent(d*1+(f-d)/2,IriSP.MyLdt.duration)-a;IriSP.jQuery("#Ldt-Show-Tags").css("left",a+"%");IriSP.jQuery("#Ldt-Show-Tags").css("width",d+"%")};